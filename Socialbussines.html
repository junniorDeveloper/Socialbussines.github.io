<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="Socialbussines.css">
    <title>SocialBussines</title>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top" id="navbar">
    
        <a class="navbar-brand" href="#">SocialBussines</a>
    
        <div class="collapse navbar-collapse show" id="navbarNav"> <!-- Se muestra automáticamente -->
            <div class="ms-auto content-list"> <!-- Alineación a la derecha -->
                <ul class="nav-list">
                    <li><a href="#" id="btn-todos" class="nav-link"><i class="fas fa-th"></i>Todos</a></li>
                    <li><a href="#" id="btn-categoria-1" class="nav-link"><i class="fas fa-tv"></i>Electrónica</a></li>
                    <li><a href="#" id="btn-categoria-2" class="nav-link"><i class="fas fa-gift"></i>Regalos</a></li>
                    <li><a href="#" id="btn-categoria-3" class="nav-link"><i class="fas fa-home"></i>Decoración</a></li>
                </ul>
            </div>
        </div>
    </nav>
    



    <div class="preview-container" id="previewContainer" onclick="hidePreview()">
        <div class="content-img">
            <img src="" id="previewImage" class="preview-image" alt="Vista Previa">
        </div>
    </div>

    <div class="container mt-4">

        <div class="row justify-content-center" id="product-card-container"></div>
    </div>

    <script>
        const baseUrl = 'http://localhost:3000/api'; // URL base

        async function fetchProduct(endpoint) {
            const url = `${baseUrl}${endpoint}`; 
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                const products = data.product; 
                displayProducts(products); 
            } catch (error) {
                console.error('Error fetching product:', error);
            }
        }

        function displayProducts(products) {
            const container = document.getElementById('product-card-container');
            container.innerHTML = ''; 

            products.forEach(displayProduct); 
        }

        function displayProduct(product) {
            const container = document.getElementById('product-card-container');

            if (!product.images || !Array.isArray(product.images)) {
                console.error('No hay imágenes disponibles para el producto:', product.name);
                return;
            }

            const images = product.images.map((img, index) => `
                <div class="content-item ${index === 0 ? 'active' : ''}">
                    <img src="${img.content}" class="d-block w-100" alt="${product.name}" onclick="showPreview('${img.content}')">
                </div>
            `).join('');

            const cardHTML = `
                <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm">
                        <h5 class="card-title">${product.name}</h5>
                        <div class="card-body">
                            <p class="card-text d-none" id="desc${product.id_product}">${product.descriptions}</p>
                            <button class="btn btn-link" onclick="toggleDescription('desc${product.id_product}')">Detalles</button>
                        </div>
                        <div ${product.id_product} class="card-img-top" data-bs-ride="carousel">
                            <div class="img-post">
                                ${images}
                            </div>
                        </div>
                        
                        <div class="card-body-price">
                                <span>Precio: S/${product.price}</span>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += cardHTML;
        }

        function toggleDescription(id) {
            const desc = document.getElementById(id);
            desc.classList.toggle('d-none');
        }

        function showPreview(imageSrc) {
            const previewContainer = document.getElementById('previewContainer');
            const previewImage = document.getElementById('previewImage');
            previewImage.src = imageSrc;
            previewContainer.style.display = 'flex';
        }

        function hidePreview() {
            const previewContainer = document.getElementById('previewContainer');
            previewContainer.style.display = 'none';
        }

        document.getElementById('btn-todos').addEventListener('click', () => fetchProduct('/products/A'));
        document.getElementById('btn-categoria-1').addEventListener('click', () => fetchProduct('/categories/A/1'));
        document.getElementById('btn-categoria-2').addEventListener('click', () => fetchProduct('/categories/A/2'));
        document.getElementById('btn-categoria-3').addEventListener('click', () => fetchProduct('/categories/A/3'));

        fetchProduct('/products/A');
    </script>

    <script>
        let lastScrollTop = 0;
        const navbar = document.getElementById("navbar");

        window.addEventListener("scroll", function() {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            if (scrollTop > lastScrollTop) {
                // Scroll hacia abajo
                navbar.style.top = "-120px"; // Oculta el menú
            } else {
                // Scroll hacia arriba
                navbar.style.top = "0"; // Muestra el menú
            }
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; // Para evitar valores negativos
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
</body>
</html>
